<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Timezone Slider</title>
        <!-- Google Fonts for a clean look -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap"
            rel="stylesheet"
        />

        <!-- Day.js for robust timezone handling -->
        <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/dayjs.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/plugin/utc.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/plugin/timezone.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/plugin/advancedFormat.js"></script>

        <style>
            /* --- Basic Setup & Theming --- */
            :root {
                --background-color: #121212;
                --surface-color: #1e1e1e;
                --primary-color: #bb86fc;
                --on-surface-color: #e0e0e0;
                --on-surface-muted: #888;
                --border-color: #333;
                --highlight-color-rgba: 187, 134, 252, 0.1;
            }

            body {
                font-family:
                    "Inter",
                    -apple-system,
                    BlinkMacSystemFont,
                    "Segoe UI",
                    Roboto,
                    Helvetica,
                    Arial,
                    sans-serif;
                background-color: var(--background-color);
                color: var(--on-surface-color);
                margin: 0;
                overscroll-behavior: none;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100vh;
            }

            /* --- App Container --- */
            .app-container {
                width: 100%;
                max-width: 800px;
                height: 100%;
                display: flex;
                flex-direction: column;
                background-color: var(--surface-color);
                border-radius: 12px;
                overflow: hidden;
                margin: 1rem;
            }

            @media (max-width: 600px) {
                .app-container {
                    margin: 0;
                    border-radius: 0;
                    height: 100vh;
                }
            }

            /* --- Header & Inputs --- */
            header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 1rem 1.5rem;
                border-bottom: 1px solid var(--border-color);
            }

            h1 {
                margin: 0;
                font-size: 1.5rem;
                color: var(--primary-color);
            }

            #shareButton {
                background-color: var(--primary-color);
                color: #121212; /* Dark text for contrast */
                border: none;
                padding: 0.6rem 1rem;
                font-size: 0.9rem;
                border-radius: 8px;
                font-weight: 500;
                cursor: pointer;
                transition:
                    background-color 0.2s,
                    transform 0.1s;
            }
            #shareButton:hover {
                background-color: #a970f7;
            }
            #shareButton:active {
                transform: scale(0.96);
            }

            .input-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1rem;
                padding: 1rem 1.5rem;
                border-bottom: 1px solid var(--border-color);
            }

            .tz-input {
                width: 100%;
                padding: 0.75rem;
                font-size: 0.9rem;
                background-color: #2c2c2c;
                border: 1px solid var(--border-color);
                color: var(--on-surface-color);
                border-radius: 8px;
                box-sizing: border-box;
            }
            .tz-input:focus {
                outline: none;
                border-color: var(--primary-color);
                box-shadow: 0 0 0 3px rgba(187, 134, 252, 0.3);
            }

            /* --- Timeline Container --- */
            .timeline-container {
                flex-grow: 1;
                position: relative;
                overflow-y: auto;
                scroll-behavior: smooth;
            }

            .timeline-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                min-height: 100%;
            }

            .timezone-column {
                border-right: 1px solid var(--border-color);
            }

            .timezone-column:last-child {
                border-right: none;
            }

            .time-row {
                height: 60px;
                display: flex;
                align-items: center;
                padding: 0 1rem;
                border-bottom: 1px solid var(--border-color);
                position: relative;
            }

            .time-row.current-hour {
                background-color: rgba(var(--highlight-color-rgba));
            }

            .time-emoji {
                font-size: 24px;
                margin-right: 1rem;
            }

            .time-info {
                flex-grow: 1;
            }

            .time-main {
                font-size: 16px;
                font-weight: 500;
                color: var(--on-surface-color);
            }

            .time-day {
                font-size: 12px;
                color: var(--on-surface-muted);
                margin-top: 2px;
            }
        </style>
    </head>
    <body>
        <div class="app-container">
            <header>
                <h1>Time Slider</h1>
                <button id="shareButton">Share</button>
            </header>

            <div class="input-grid">
                <input
                    type="text"
                    id="tzInputA"
                    class="tz-input"
                    list="timezone-list"
                    placeholder="Select timezone..."
                />
                <input
                    type="text"
                    id="tzInputB"
                    class="tz-input"
                    list="timezone-list"
                    placeholder="Select timezone..."
                />
            </div>

            <div class="timeline-container" id="timelineContainer">
                <div class="timeline-grid" id="timelineGrid">
                    <div class="timezone-column" id="columnA"></div>
                    <div class="timezone-column" id="columnB"></div>
                </div>
            </div>
        </div>

        <datalist id="timezone-list"></datalist>

        <script>
            // --- Initialize Day.js Plugins ---
            dayjs.extend(dayjs_plugin_utc);
            dayjs.extend(dayjs_plugin_timezone);
            dayjs.extend(dayjs_plugin_advancedFormat);

            // --- DOM Elements ---
            const timelineContainer =
                document.getElementById("timelineContainer");
            const timelineGrid = document.getElementById("timelineGrid");
            const columnA = document.getElementById("columnA");
            const columnB = document.getElementById("columnB");
            const inputA = document.getElementById("tzInputA");
            const inputB = document.getElementById("tzInputB");
            const timezoneDatalist = document.getElementById("timezone-list");

            // --- State Management ---
            const state = {
                tzA: dayjs.tz.guess(),
                tzB: "America/New_York",
            };

            function getEmojiForTime(timeObject) {
                const hour = timeObject.hour();
                if (hour >= 6 && hour < 18) return "☀️"; // Daytime
                if (hour >= 18 && hour < 21) return "🌅"; // Dusk
                return "🌙"; // Nighttime
            }

            // --- Timezone Data ---
            const commonTimezones = Intl.supportedValuesOf("timeZone");
            commonTimezones.forEach((tz) => {
                const option = document.createElement("option");
                option.value = tz;
                timezoneDatalist.appendChild(option);
            });

            // --- Timeline Rendering ---
            function createTimeRow(timeObject, referenceNow, columnElement) {
                const row = document.createElement("div");
                row.className = "time-row";

                // Highlight current hour
                if (
                    timeObject.hour() === referenceNow.hour() &&
                    timeObject.isSame(referenceNow, "day")
                ) {
                    row.classList.add("current-hour");
                }

                const emoji = getEmojiForTime(timeObject);
                const timeText = timeObject.format("h:mm A");

                let dayText = "";
                if (timeObject.isAfter(referenceNow, "day"))
                    dayText = "Tomorrow";

                row.innerHTML = `
                <span class="time-emoji">${emoji}</span>
                <div class="time-info">
                    <div class="time-main">${timeText}</div>
                    ${dayText ? `<div class="time-day">${dayText}</div>` : ""}
                </div>
            `;

                return row;
            }

            function renderTimeline() {
                // Clear existing content
                columnA.innerHTML = "";
                columnB.innerHTML = "";

                const baseNow = dayjs().tz(state.tzA);
                const nowA = dayjs().tz(state.tzA);
                const nowB = dayjs().tz(state.tzB);

                // Generate 48 hours (24 before current hour, 24 after)
                const currentHour = baseNow.hour();
                const startHour = currentHour - 24;
                const endHour = currentHour + 24;

                for (let i = startHour; i <= endHour; i++) {
                    const timeA = baseNow.hour(i).minute(0).second(0);
                    const timeB = timeA.tz(state.tzB);

                    const rowA = createTimeRow(timeA, nowA, columnA);
                    const rowB = createTimeRow(timeB, nowB, columnB);

                    columnA.appendChild(rowA);
                    columnB.appendChild(rowB);
                }

                // Scroll to current hour (center it)
                setTimeout(() => {
                    const currentRowIndex = 24; // Current hour is at index 24
                    const targetRow = columnA.children[currentRowIndex];
                    if (targetRow) {
                        targetRow.scrollIntoView({ block: "center" });
                    }
                }, 100);
            }

            // --- UI & Event Listeners ---
            function updateInputWithOffset(inputElement, timezone) {
                const offset = dayjs().tz(timezone).format("Z");
                const tzName = timezone.replace(/_/g, " ");
                inputElement.value = `${tzName} (${offset})`;
            }

            function handleInput(e, tzKey) {
                const newTz = e.target.value;
                if (commonTimezones.includes(newTz)) {
                    state[tzKey] = newTz;
                    updateInputWithOffset(e.target, newTz);
                    renderTimeline(); // Re-render timeline with new timezone
                } else {
                    updateInputWithOffset(e.target, state[tzKey]);
                }
            }

            function addShareButtonListener() {
                const shareButton = document.getElementById("shareButton");
                shareButton.addEventListener("click", () => {
                    const url = new URL(window.location);
                    url.searchParams.set("tzA", state.tzA);
                    url.searchParams.set("tzB", state.tzB);

                    const tempInput = document.createElement("input");
                    tempInput.value = url.href;
                    document.body.appendChild(tempInput);
                    tempInput.select();
                    try {
                        document.execCommand("copy");
                        shareButton.textContent = "Copied!";
                    } catch (err) {
                        shareButton.textContent = "Error!";
                        console.error("Failed to copy URL: ", err);
                    }
                    document.body.removeChild(tempInput);

                    setTimeout(() => {
                        shareButton.textContent = "Share";
                    }, 2000);
                });
            }

            inputA.addEventListener("change", (e) => handleInput(e, "tzA"));
            inputB.addEventListener("change", (e) => handleInput(e, "tzB"));

            // No custom scroll handling needed - browser handles it natively!

            // --- Initialization ---
            function init() {
                // Parse URL parameters on load
                const urlParams = new URLSearchParams(window.location.search);
                const urlTzA = urlParams.get("tzA");
                const urlTzB = urlParams.get("tzB");

                if (urlTzA && commonTimezones.includes(urlTzA)) {
                    state.tzA = urlTzA;
                }
                if (urlTzB && commonTimezones.includes(urlTzB)) {
                    state.tzB = urlTzB;
                }

                updateInputWithOffset(inputA, state.tzA);
                updateInputWithOffset(inputB, state.tzB);
                addShareButtonListener();
                renderTimeline(); // Render the timeline instead of canvas
            }

            init();
        </script>
    </body>
</html>
